/*

‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ïó‚ñë‚ñë‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ñà‚ïó‚ñë‚ñë‚ñà‚ñà‚ïó‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà‚ñà‚ïó‚ñë‚ñë‚ñë‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë
‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë
‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïù‚ñë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù‚ñë‚ñë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñë‚ñë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë‚ïö‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë
‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñë‚ïö‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñë‚ïö‚ñà‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ïö‚ïê‚ïù‚ñë‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù
‚ïö‚ïê‚ïù‚ñë‚ñë‚ñë‚ñë‚ñë‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù‚ñë‚ñë‚ïö‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ñë‚ïö‚ïê‚ïù‚ñë‚ñë‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù‚ñë‚ñë‚ïö‚ïê‚ïù‚ñë‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ñë‚ñë‚ïö‚ïê‚ïê‚ïê‚ïê‚ïù‚ñë‚ïö‚ïê‚ïù‚ñë‚ñë‚ïö‚ïê‚ïê‚ïù‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïö‚ïê‚ïù‚ñë‚ñë‚ñë‚ñë‚ñë‚ïö‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ñë
*/

const fs = require("fs");
const Jimp = require("jimp");
const moment = require("moment-timezone");
const {
  setWelcome, // ------------------- SET WELCOME MESSAGE
  checkWelcome, // ----------------- CHECK WELCOME MESSAGE STATUS
  delWelcome, // ------------------- DELETE WELCOME MESSAGE
  setAntilink, // ------------------ SET ANTILINK
  checkAntilink, // ---------------- CHECK ANTILINK STATUS
  delAntilink, // ------------------ DELETE ANTILINK
  setGroupChatbot, // -------------- SET GROUP CHATBOT
  checkGroupChatbot, // ------------ CHECK GROUP CHATBOT STATUS
  delGroupChatbot,
} = require("../System/MongoDB/MongoDb_Core");
let mergedCommands = [
  "admins",
  "admin",
  "setgcname",
  "delete",
  "antilink",
  "welcome",
  "del",
  "demote",
  "gclink",
  "grouplink",
  "group",
  "gc",
  "groupinfo",
  "gcinfo",
  "hidetag",
  "htag",
  "leave",
  "promote",
  "remove",
  "revoke",
  "setgcdesc",
  "setppgc",
  "tagall",
  "chatbotgc",
  "antilink",
  "welcome",
];

module.exports = {
  name: "groupanagement",
  alias: [...mergedCommands],
  uniquecommands: [
    "admins",
    "setgcname",
    "delete",
    "demote",
    "gclink",
    "antilink",
    "welcome",
    "group",
    "gc",
    "gcinfo",
    "tagall",
    "hidetag",
    "leave",
    "promote",
    "remove",
    "revoke",
    "setgcdesc",
    "setppgc",
    "chatbotgc",
  ],
  description: "‡∑É‡∑í‡∂∫‡∂Ω‡∑î‡∂∏ ‡∑Å‡∑ä‚Äç‡∂ª‡∑Ä‡∑ä‚Äç‡∂∫ ‡∑É‡∂Ç‡∑É‡∑ä‡∂ö‡∂ª‡∂´ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±",
  start: async (
    Pendragon,
    m,
    {
      inputCMD,
      text,
      prefix,
      doReact,
      args,
      itsMe,
      participants,
      metadata,
      mentionByTag,
      mime,
      isMedia,
      quoted,
      botNumber,
      isBotAdmin,
      groupAdmin,
      isAdmin,
    }
  ) => {
    let messageSender = m.sender;
    let quotedsender = m.quoted ? m.quoted.sender : mentionByTag[0];
    switch (inputCMD) {
      case "admins":
      case "admin":
        if (!isMedia) {
          message = m.quoted ? m.quoted.msg : "„Äé *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö‡∑Ä‡∂ª‡∑î‡∂±‡∑ä‡∂ú‡∑ö ‡∂Ö‡∑Ä‡∂∞‡∑è‡∂±‡∂∫‡∂ß*";
        } else {
          message =
            "„Äé *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö‡∑Ä‡∂ª‡∑î‡∂±‡∑ä‡∂ú‡∑ö ‡∂Ö‡∑Ä‡∂∞‡∑è‡∂±‡∂∫‡∂ß*\n\n*üéÄ ‡∂¥‡∂´‡∑í‡∑Ä‡∑í‡∂©‡∂∫:* ‡∂∏‡∑ô‡∂∫ ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∑è ‡∂ö‡∂ª‡∂±‡∑ä‡∂± !";
        }
        await doReact("üèÖ");
        Pendragon.sendMessage(
          m.from,
          { text: message, mentions: groupAdmin },
          { quoted: m }
        );
        break;

      case "setgcname":
        if (!isAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *‡∂î‡∂∂* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }
        if (!isBotAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *Bot* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }
        if (!text) {
          await doReact("‚ùî");
          return m.reply(
            `‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂±‡∑Ä ‡∂ö‡∂´‡∑ä‡∂©‡∑è‡∂∫‡∂∏‡∑ä ‡∂±‡∂∏‡∂ö‡∑ä ‡∂Ω‡∂∂‡∑è ‡∂Ø‡∑ô‡∂±‡∑ä‡∂± !\n\n‡∂ã‡∂Ø‡∑è‡∑Ñ‡∂ª‡∂´‡∂∫‡∂ö‡∑ä: *${prefix}setgcname Bot Testing*`
          );
        }
        await doReact("üéê");

        oldGCName = metadata.subject;

        try {
          ppgc = await Pendragon.profilePictureUrl(m.from, "image");
        } catch {
          ppgc = botImage1;
        }

        await Pendragon.groupUpdateSubject(m.from, text)
          .then((res) =>
            Pendragon.sendMessage(
              m.from,
              {
                image: { url: ppgc, mimetype: "image/jpeg" },
                caption: `*„Äé ‡∑É‡∂∏‡∑ñ‡∑Ñ ‡∂±‡∂∏ ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∂ö‡∂ª ‡∂á‡∂≠*\n\n_üî∂ ‡∂¥‡∑ê‡∂ª‡∂´‡∑í ‡∂±‡∂∏:_\n*${oldGCName}*\n\n_üî∑ ‡∂Ö‡∂Ω‡∑î‡∂≠‡∑ä ‡∂±‡∂∏:_\n*${text}*\n`,
              },
              { quoted: m }
            )
          )
          .catch((err) => replay(jsonformat(err)));
        break;

      case "delete":
      case "del":
        if (!isAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *‡∂î‡∂∂* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }
        if (!m.quoted) {
          await doReact("‚ùî");
          return m.reply(`‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂ë‡∂∫ ‡∂∏‡∑ê‡∂ö‡∑ì‡∂∏‡∂ß ‡∂¥‡∂´‡∑í‡∑Ä‡∑í‡∂©‡∂∫‡∂ö‡∂ß *‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª‡∑î ‡∂Ø‡∑ô‡∂±‡∑ä‡∂±* !`);
        }
        if (!isBotAdmin) {
          if (!m.quoted.sender.includes(botNumber)) {
            await doReact("‚ùå");
            return m.reply(
              `‡∑É‡∂∏‡∑è‡∑Ä‡∂±‡∑ä‡∂±, *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∂Ö‡∑Ä‡∑É‡∂ª‡∂∫‡∂ö‡∑í‡∂±‡∑ä ‡∂≠‡∑ú‡∂ª‡∑Ä, ‡∂∏‡∂ß ‡∂∏‡∂ö‡∑è ‡∂Ø‡∑ê‡∂∏‡∑í‡∂∫ ‡∑Ñ‡∑ê‡∂ö‡∑ä‡∂ö‡∑ö ‡∂∏‡∂ú‡∑ö‡∂∏ ‡∂¥‡∂´‡∑í‡∑Ä‡∑í‡∂© ‡∂¥‡∂∏‡∂´‡∑í !`
            );
          }
          key = {
            remoteJid: m.from,
            fromMe: true,
            id: m.quoted.id,
          };
          await doReact("üìõ");
          await Pendragon.sendMessage(m.from, { delete: key });
        } else {
          if (!isAdmin) {
            await doReact("‚ùå");
            return m.reply(
              `‡∑É‡∂∏‡∑è‡∑Ä‡∂±‡∑ä‡∂±, ‡∂Ö‡∂±‡∑ä ‡∂Ö‡∂∫‡∂ú‡∑ö ‡∂¥‡∂´‡∑í‡∑Ä‡∑í‡∂© ‡∂∏‡∂ö‡∑è ‡∂Ø‡∑ê‡∂∏‡∑í‡∂∫ ‡∑Ñ‡∑ê‡∂ö‡∑ä‡∂ö‡∑ö *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö‡∂∫‡∑í‡∂±‡∑ä‡∂ß* ‡∂¥‡∂∏‡∂´‡∑í!`
            );
          }
          key = {
            remoteJid: m.from,
            fromMe: false,
            id: m.quoted.id,
            participant: m.quoted.sender,
          };

          await Pendragon.sendMessage(m.from, { delete: key });
        }

        break;

      case "demote":
        if (!isAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *‡∂î‡∂∂* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }
        if (!isBotAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *Bot* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }
        if (quotedsender.includes(m.sender)) {
          await doReact("‚ùå");
          return m.reply(`‡∂î‡∂∂‡∂ß ‡∂î‡∂∂‡∑Ä ‡∂¥‡∑Ñ‡∂≠‡∑ä ‡∂ö‡∑Ö ‡∂±‡∑ú‡∑Ñ‡∑ê‡∂ö !`);
        }
        if (quotedsender.includes(botNumber)) {
          await doReact("‚ùå");
          return m.reply(`‡∂ö‡∂´‡∂ú‡∑è‡∂ß‡∑î‡∂∫‡∑í, ‡∂∏‡∂ß ‡∂∏‡∑è‡∑Ä‡∂∏ ‡∂¥‡∑Ñ‡∂≠‡∑ä ‡∂ö‡∑Ö ‡∂±‡∑ú‡∑Ñ‡∑ê‡∂ö !`);
        }

        if (!text && !m.quoted) {
          await doReact("‚ùî");
          return m.reply(`‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂¥‡∂ª‡∑í‡∑Å‡∑ì‡∂Ω‡∂ö‡∂∫‡∑ô‡∂ö‡∑î ‡∂¥‡∑Ñ‡∂≠‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß ‡∂ß‡∑ê‡∂ú‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±!`);
        } else if (m.quoted) {
          mentionedUser = m.quoted.sender;
        } else {
          mentionedUser = mentionByTag[0];
        }

        userId = (await mentionedUser) || m.msg.contextInfo.participant;
        if (!groupAdmin.includes(userId)) {
          return Pendragon.sendMessage(
            m.from,
            {
              text: `@${
                mentionedUser.split("@")[0]
              } Bot ‡∂∏‡∑ô‡∂∏ ‡∑É‡∂∏‡∑ñ‡∑Ñ‡∂∫‡∑ö *‡∂á‡∂©‡∑ä‡∂∏‡∑í‡∂±‡∑ä* ‡∂±‡∑ú‡∑Ä‡∑ö!`,
              mentions: [mentionedUser],
            },
            { quoted: m }
          );
        }
        await doReact("üìâ");
        try {
          await Pendragon.groupParticipantsUpdate(m.from, [userId], "demote").then(
            (res) =>
              Pendragon.sendMessage(
                m.from,
                {
                  text: `Sorry @${
                    mentionedUser.split("@")[0]
                  } ‡∂∂‡∑ú‡∂ß‡∑ä, ‡∂î‡∂∂‡∑Ä ‡∂¥‡∑Ñ‡∂≠‡∑ä ‡∂ö‡∂ª ‡∂á‡∂≠* by @${
                    messageSender.split("@")[0]
                  } !`,
                  mentions: [mentionedUser, messageSender],
                },
                { quoted: m }
              )
          );
        } catch (error) {
          await doReact("‚ùå");
          Pendragon.sendMessage(
            m.from,
            {
              text: `‡∂¥‡∑Ñ‡∂≠ ‡∑Ñ‡∑ô‡∂Ω‡∑ì‡∂∏‡∂ß ‡∂ã‡∂≠‡∑ä‡∑É‡∑è‡∑Ñ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö‡∂Ø‡∑ì ‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑ä ‡∂á‡∂≠‡∑í ‡∑Ä‡∑í‡∂∫ @${
                mentionedUser.split("@")[0]
              } Bot !\n\n*‡∂Ø‡∑ù‡∑Ç‡∂∫:* ${error}`,
              mentions: [mentionedUser],
            },
            { quoted: m }
          );
        }

        break;

      case "gclink":
      case "grouplink":
        if (!isBotAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *Bot* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }
        await doReact("üß©");
        let link = await Pendragon.groupInviteCode(m.from);
        let linkcode = `https://chat.whatsapp.com/${link}`;

        try {
          ppgc = await Pendragon.profilePictureUrl(m.from, "image");
        } catch {
          ppgc = botImage1;
        }

        try {
          await Pendragon.sendMessage(
            m.from,
            {
              image: { url: ppgc, mimetype: "image/jpeg" },
              caption: `\n_üéÄ ‡∂ö‡∂´‡∑ä‡∂©‡∑è‡∂∫‡∂∏‡∑ö ‡∂±‡∂∏:_ *${metadata.subject}*\n\n_üß© ‡∂ö‡∂´‡∑ä‡∂©‡∑è‡∂∫‡∂∏‡∑ä ‡∑É‡∂∂‡∑ê‡∂≥‡∑í‡∂∫:_\n${linkcode}\n`,
            },
            { quoted: m }
          );
        } catch (err) {
          Pendragon.sendMessage(
            m.from,
            { text: `${mess.botadmin}` },
            { quoted: m }
          );
        }
        break;

      case "group":
      case "gc":
        if (!isAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *‡∂î‡∂∂* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }
        if (!isBotAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *Bot* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }
        await doReact("‚öúÔ∏è");

        if (text === "close") {
          await Pendragon.groupSettingUpdate(m.from, "announcement").then((res) =>
            m.reply(`‡∑É‡∂∏‡∑ñ‡∑Ñ‡∂∫ ‡∑Ä‡∑É‡∑è ‡∂á‡∂≠!`)
          );
        } else if (text === "open") {
          await Pendragon.groupSettingUpdate(m.from, "not_announcement").then(
            (res) => m.reply(`Group has been opened!`)
          );
        } else {
          await Pendragon.sendMessage(
            m.from,
            {
              image: { url: botImage2 },
              caption: `\n*„Äå ‡∂ö‡∂´‡∑ä‡∂©‡∑è‡∂∫‡∂∏‡∑ä ‡∂¥‡∂´‡∑í‡∑Ä‡∑í‡∂© ‡∑É‡∑ê‡∂ö‡∑É‡∑ì‡∂∏‡∑ä „Äç*\n\n‡∂¥‡∑Ñ‡∂≠ ‡∑Ä‡∑í‡∂ö‡∂Ω‡∑ä‡∂¥‡∂∫‡∂ö‡∑ä ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂±.\n\n*_Usage:_*\n\n*${prefix}group open*\n*${prefix}group close*\n`,
            },
            { quoted: m }
          );
        }

        break;

      case "groupinfo":
      case "gcinfo":
        if (!m.isGroup) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑Ö ‡∑Ñ‡∑ê‡∂ö‡∑ä‡∂ö‡∑ö ‡∂ö‡∂´‡∑ä‡∂©‡∑è‡∂∫‡∂∏‡∑ä ‡∑Ä‡∑Å‡∂∫‡∑ô‡∂±‡∑ä ‡∂¥‡∂∏‡∂´‡∑í!`);
        }
        await doReact("üéä");
        try {
          ppgc = await Pendragon.profilePictureUrl(m.from, "image");
        } catch {
          ppgc = botImage1;
        }
        participants = m.isGroup ? await metadata.participants : "";
        groupAdmins = m.isGroup
          ? await participants.filter((v) => v.admin !== null).map((v) => v.id)
          : "";
        groupOwner = m.isGroup ? metadata.owner : "";
        desc = metadata.desc ? metadata.desc : "No Description";
        let txt = `                 *„Äé ‡∂ö‡∂´‡∑ä‡∂©‡∑è‡∂∫‡∂∏‡∑ä ‡∂≠‡∑ú‡∂ª‡∂≠‡∑î‡∂ª‡∑î „Äè*\n\n_üéÄ ‡∂ö‡∂´‡∑ä‡∂©‡∑è‡∂∫‡∂∏‡∑ö ‡∂±‡∂∏:_ *${
          metadata.subject
        }*\n\n_üß© ‡∂ö‡∂´‡∑ä‡∂©‡∑è‡∂∫‡∂∏‡∑ä ‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª‡∂∫:_\n${desc}\n\n_üëë ‡∑É‡∂∏‡∑ñ‡∑Ñ ‡∑Ñ‡∑í‡∂∏‡∑í‡∂ö‡∂ª‡∑î:_ @${
          metadata.owner.split("@")[0]
        }\n_üí´ ‡∑É‡∂∏‡∑ñ‡∑Ñ‡∂∫ ‡∑É‡∑è‡∂Ø‡∂± ‡∂Ω‡∂Ø‡∑ä‡∂Ø‡∑ö:_ *${moment(`${metadata.creation}` * 1000)
          .tz("Asia/Colombo")
          .format("DD/MM/YYYY")}*\n_üìõ ‡∑É‡∂∏‡∑ä‡∂¥‡∑ñ‡∂ª‡∑ä‡∂´ ‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö‡∂∫‡∑í‡∂±‡∑ä:_ *${
          groupAdmins.length
        }*\n_üéà ‡∂∏‡∑î‡∑Ö‡∑î ‡∑É‡∑Ñ‡∂∑‡∑è‡∂ú‡∑í‡∑Ä‡∂±‡∑ä‡∂±‡∂±‡∑ä:_ *${metadata.participants.length}*\n`;

        await Pendragon.sendMessage(
          m.from,
          {
            image: { url: ppgc, mimetype: "image/jpeg" },
            caption: txt,
            mentions: [metadata.owner],
          },
          { quoted: m }
        );
        break;

      case "hidetag":
      case "htag":
        if (!isAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *‡∂î‡∂∂* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }
        if (!isMedia) {
          message2 = m.quoted
            ? m.quoted.msg
            : args[0]
            ? args.join(" ")
            : "„Äé *‡∑É‡∑ê‡∂∏‡∂ú‡∑ö ‡∂Ö‡∑Ä‡∂∞‡∑è‡∂±‡∂∫‡∂ß* „Äè";
        } else {
          message2 =
            "„Äé *‡∑É‡∑ê‡∂∏‡∂ú‡∑ö ‡∂Ö‡∑Ä‡∂∞‡∑è‡∂±‡∂∫‡∂ß* „Äè\n\n*üéÄ ‡∂¥‡∂´‡∑í‡∑Ä‡∑í‡∂©‡∂∫:* ‡∂∏‡∑ô‡∂∫ ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∑è ‡∂ö‡∂ª‡∂±‡∑ä‡∂± !";
        }

        await doReact("üéå");
        Pendragon.sendMessage(
          m.from,
          { text: message2, mentions: participants.map((a) => a.id) },
          { quoted: m }
        );
        break;

      case "leave":
        if (!isAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *‡∂î‡∂∂* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }
        await doReact("üëã");
        await Pendragon.sendMessage(m.from, {
          image: { url: "https://wallpapercave.com/wp/wp9667218.png" },
          caption: `‡∂∏‡∂∏ ‡∂â‡∂Ω‡∑ä‡∂Ω‡∑ì‡∂∏ ‡∂∏‡∂≠ ‡∂∏‡∑ô‡∂∏ ‡∑É‡∂∏‡∑ñ‡∑Ñ‡∂∫‡∑ô‡∂±‡∑ä ‡∂â‡∑Ä‡∂≠‡∑ä ‡∑Ä‡∑ô‡∂∏‡∑í... \n\n‡∑Ñ‡∑ê‡∂∏‡∑ù‡∂∏ ‡∂∂‡∂Ω‡∑è‡∂ú‡∂±‡∑ä‡∂± :)`,
          mentions: participants.map((a) => a.id),
          quoted: m,
        }).then(async () => {
          Pendragon.groupLeave(m.from).catch((e) => {
            Pendragon.sendMessage(
              m.from,
              { text: `‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑ä ‡∑É‡∑í‡∂Ø‡∑î ‡∑Ä‡∑í‡∂∫ !` },
              { quoted: m }
            );
          });
        });
        break;

      case "promote":
        if (!isAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *‡∂î‡∂∂* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }
        if (!isBotAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *Bot* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }
        if (quotedsender.includes(m.sender)) {
          await doReact("‚ùå");
          return m.reply(`‡∂î‡∂∂ ‡∂Ø‡∑ê‡∂±‡∂ß‡∂∏‡∂≠‡∑ä ‡∂∏‡∑ô‡∂∏ ‡∑É‡∂∏‡∑ñ‡∑Ñ‡∂∫‡∑ö *‡∂á‡∂©‡∑ä‡∂∏‡∑í‡∂±‡∑ä* ‡∂ö‡∑ô‡∂±‡∑ô‡∂ö‡∑ä!`);
        }
        if (quotedsender.includes(botNumber)) {
          await doReact("‚ùå");
          return m.reply(`I am already an *Admin* of this group!`);
        }

        if (!text && !m.quoted) {
          await doReact("‚ùî");
          return m.reply(`‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª *‡∂¥‡∑ä‚Äç‡∂ª‡∑Ä‡∂ª‡∑ä‡∂∞‡∂±‡∂∫* ‡∑É‡∂≥‡∑Ñ‡∑è ‡∂¥‡∂ª‡∑í‡∑Å‡∑ì‡∂Ω‡∂ö‡∂∫‡∑ô‡∂ö‡∑î ‡∂ß‡∑ê‡∂ú‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±!`);
        } else if (m.quoted) {
          mentionedUser = m.quoted.sender;
        } else {
          mentionedUser = mentionByTag[0];
        }

        userId = (await mentionedUser) || m.msg.contextInfo.participant;
        if (groupAdmin.includes(userId)) {
          return Pendragon.sendMessage(
            m.from,
            {
              text: `@${
                mentionedUser.split("@")[0]
              } ‡∂∂‡∑ú‡∂ß‡∑ä ‡∂Ø‡∑ê‡∂±‡∂ß‡∂∏‡∂≠‡∑ä ‡∂∏‡∑ô‡∂∏ ‡∑É‡∂∏‡∑ñ‡∑Ñ‡∂∫‡∑ö *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö‡∂∫‡∑ô‡∂ö‡∑í!`,
              mentions: [mentionedUser],
            },
            { quoted: m }
          );
        }
        await doReact("üíπ");
        try {
          await Pendragon.groupParticipantsUpdate(m.from, [userId], "promote").then(
            (res) =>
              Pendragon.sendMessage(
                m.from,
                {
                  text: `‡∑É‡∑î‡∂∑ ‡∂¥‡∑ê‡∂≠‡∑î‡∂∏‡∑ä  @${
                    mentionedUser.split("@")[0]
                  } Bot ü•≥, ‡∂î‡∂∂ ‡∂ã‡∑É‡∑É‡∑ä ‡∂ö‡∂ª ‡∂á‡∂≠* by @${
                    messageSender.split("@")[0]
                  } !`,
                  mentions: [mentionedUser, messageSender],
                },
                { quoted: m }
              )
          );
        } catch (error) {
          Pendragon.sendMessage(
            m.from,
            {
              text: `‡∂¥‡∑Ñ‡∂≠ ‡∑Ñ‡∑ô‡∂Ω‡∑ì‡∂∏‡∂ß ‡∂ã‡∂≠‡∑ä‡∑É‡∑è‡∑Ñ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö‡∂Ø‡∑ì ‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑ä ‡∂á‡∂≠‡∑í ‡∑Ä‡∑í‡∂∫ @${
                mentionedUser.split("@")[0]
              } Bot !\n\n*‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑í:* ${error}`,
              mentions: [mentionedUser],
            },
            { quoted: m }
          );
        }

        break;

      case "remove":
        if (!isAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *‡∂î‡∂∂* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }
        if (!isBotAdmin) {
          await doReact("‚ùå");
          return m.reply(`*Bot* must be *Admin* in order to use this Command!`);
        }
        if (quotedsender.includes(m.sender)) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *Bot* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }
        if (quotedsender.includes(botNumber)) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∂ß ‡∂∏‡∑ô‡∂∏ ‡∑É‡∂∏‡∑ñ‡∑Ñ‡∂∫‡∑ô‡∂±‡∑ä ‡∂∏‡∑è ‡∂â‡∑Ä‡∂≠‡∑ä ‡∂ö‡∑Ö ‡∂±‡∑ú‡∑Ñ‡∑ê‡∂ö!`);
        }

        if (!text && !m.quoted) {
          await doReact("‚ùî");
          return Pendragon.sendMessage(
            m.from,
            { text: `‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª *‡∂â‡∑Ä‡∂≠‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß* ‡∂¥‡∂ª‡∑í‡∑Å‡∑ì‡∂Ω‡∂ö‡∂∫‡∑ô‡∂ö‡∑î ‡∂ß‡∑ê‡∂ú‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂± !` },
            { quoted: m }
          );
        } else if (m.quoted) {
          var mentionedUser = m.quoted.sender;
        } else {
          var mentionedUser = mentionByTag[0];
        }

        let users = (await mentionedUser) || m.msg.contextInfo.participant;
        await doReact("‚õî");
        if (groupAdmin.includes(users)) {
          return Pendragon.sendMessage(
            m.from,
            {
              text: `*‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂ö‡∑ä‡∑Ç‡∑ö‡∂¥ ‡∑Ä‡∑í‡∂∫ !* @${
                mentionedUser.split("@")[0]
              } ‡∂∂‡∑ú‡∂ß‡∑ä ‡∂∏‡∑ô‡∂∏ ‡∑É‡∂∏‡∑ñ‡∑Ñ‡∂∫‡∑ö *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö‡∂∫‡∑ô‡∂ö‡∑í* ‡∂ë‡∂∂‡∑ê‡∑Ä‡∑í‡∂±‡∑ä ‡∂î‡∂∂‡∂ß ‡∂î‡∑Ñ‡∑î‡∑Ä ‡∂â‡∑Ä‡∂≠‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß ‡∂Ö‡∑Ä‡∑É‡∂ª ‡∂±‡∑ê‡∂≠ !`,
              mentions: [mentionedUser],
            },
            { quoted: m }
          );
        }

        await Pendragon.groupParticipantsUpdate(m.from, [users], "remove").then(
          (res) =>
            Pendragon.sendMessage(
              m.from,
              {
                text: `@${
                  mentionedUser.split("@")[0]
                } ‡∑Ä‡∑ô‡∂≠‡∑í‡∂±‡∑ä ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∑Ä *‡∂â‡∑Ä‡∂≠‡∑ä ‡∂ö‡∂ª ‡∂á‡∂≠* *${metadata.subject}*`,
                mentions: [mentionedUser],
              },
              { quoted: m }
            )
        );

        break;

      case "setppgc":
        if (!isAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *‡∂î‡∂∂* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }
        if (!isBotAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *Bot* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }

        if (!/image/.test(mime)) {
          await doReact("‚ùå");
          return Pendragon.sendMessage(
            m.from,
            {
              text: `‡∑Å‡∑ì‡∂ª‡∑ä‡∑Ç ‡∂¥‡∑è‡∂®‡∂∫ ‡∑É‡∂∏‡∂ü ‡∂ª‡∑ñ‡∂¥‡∂∫ ‡∂∫‡∑Ä‡∂±‡∑ä‡∂±/‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª‡∑î ‡∂Ø‡∑ô‡∂±‡∑ä‡∂± ${
                prefix + "setgcpp"
              } ‡∂∏‡∑ô‡∂∏ ‡∑É‡∂∏‡∑ñ‡∑Ñ‡∂∫‡∑ö Profile Pic ‡∂ë‡∂ö ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß.`,
            },
            { quoted: m }
          );
        }
        await doReact("üé¥");

        let quotedimage = await Pendragon.downloadAndSaveMediaMessage(quoted);
        var { preview } = await generatePP(quotedimage);

        await Pendragon.query({
          tag: "iq",
          attrs: {
            to: m.from,
            type: "set",
            xmlns: "w:profile:picture",
          },
          content: [
            {
              tag: "picture",
              attrs: { type: "image" },
              content: preview,
            },
          ],
        });
        fs.unlinkSync(quotedimage);

        ppgc = await Pendragon.profilePictureUrl(m.from, "image");

        Pendragon.sendMessage(
          m.from,
          {
            image: { url: ppgc },
            caption: `\n‡∑É‡∂∏‡∑ñ‡∑Ñ ‡∂¥‡∑ê‡∂≠‡∑í‡∂ö‡∂© ‡∂¥‡∑í‡∂±‡∑ä‡∂≠‡∑ñ‡∂ª‡∂∫ ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∑Ä ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∂ö‡∂ª ‡∂á‡∂≠ by @${
              messageSender.split("@")[0]
            } !`,
            mentions: [messageSender],
          },
          { quoted: m }
        );

        break;

      case "setgcdesc":
        if (!isAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *‡∂î‡∂∂* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }
        if (!isBotAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *Bot* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }

        if (!text && !m.quoted) {
          await doReact("‚ùî");
          return Pendragon.sendMessage(
            m.from,
            { text: `‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂±‡∑Ä ‡∂ö‡∂´‡∑ä‡∂©‡∑è‡∂∫‡∂∏‡∑ä ‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª‡∂∫‡∂ö‡∑ä ‡∑É‡∂¥‡∂∫‡∂±‡∑ä‡∂±!` },
            { quoted: m }
          );
        }

        await doReact("üìë");

        try {
          ppgc = await Pendragon.profilePictureUrl(m.from, "image");
        } catch {
          ppgc = botImage1;
        }

        var newGCdesc = m.quoted ? m.quoted.msg : text;

        await Pendragon.groupUpdateDescription(m.from, newGCdesc).then((res) =>
          Pendragon.sendMessage(
            m.from,
            {
              image: { url: ppgc, mimetype: "image/jpeg" },
              caption: `*„Äé ‡∂ö‡∂´‡∑ä‡∂©‡∑è‡∂∫‡∂∏‡∑ä ‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª‡∂∫ ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∂ª‡∂± ‡∂Ω‡∂Ø‡∑ì „Äè*\n\n_üß© ‡∂±‡∑Ä ‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª‡∂∫:_\n*${newGCdesc}*`,
            },
            { quoted: m }
          )
        );

        break;

      case "revoke":
        if (!isAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *‡∂î‡∂∂* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }
        if (!isBotAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *Bot* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }

        if (m.from == "120363040838753957@g.us") {
          await doReact("‚ùå");
          return m.reply(
            "‡∑É‡∂∏‡∑è‡∑Ä‡∂±‡∑ä‡∂±, ‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ *Pendragon Support Group* ‡∑Ñ‡∑í ‡∂Ö‡∑Ä‡∑É‡∂ª ‡∂±‡∑ê‡∂≠ !\n\n‡∂î‡∂∂‡∂ß ‡∑É‡∑Ñ‡∑è‡∂∫ ‡∂ö‡∂´‡∑ä‡∂©‡∑è‡∂∫‡∂∏‡∑ä ‡∑É‡∂∂‡∑ê‡∂≥‡∑í‡∂∫ ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß ‡∂Ö‡∑Ä‡∑É‡∂ª ‡∂±‡∑ê‡∂≠ !"
          );
        }
        await doReact("üí´");

        await Pendragon.groupRevokeInvite(m.from).then((res) =>
          Pendragon.sendMessage(
            m.from,
            { text: `‡∂ö‡∂´‡∑ä‡∂©‡∑è‡∂∫‡∂∏‡∑ä ‡∑É‡∂∂‡∑ê‡∂≥‡∑í‡∂∫ *‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∂ö‡∂ª ‡∂á‡∂≠* ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∑Ä!` },
            { quoted: m }
          )
        );

        break;

      case "tagall":
        if (!isAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *‡∂î‡∂∂* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }
        if (!isBotAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *Bot* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }
        if (!isMedia) {
          var message2 = m.quoted
            ? m.quoted.msg
            : args[0]
            ? args.join(" ")
            : "No message";
        } else {
          message2 = "‡∂∏‡∑ô‡∂∫ ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∑è ‡∂ö‡∂ª‡∂±‡∑ä‡∂±!";
        }

        let mess = `            „Äé *‡∑É‡∑ê‡∂∏‡∂ú‡∑ö ‡∂Ö‡∑Ä‡∂∞‡∑è‡∂±‡∂∫‡∂ß* „Äè
    
*‚öúÔ∏è Tagged by:* @${m.sender.split("@")[0]}
            
*üß© ‡∂¥‡∂´‡∑í‡∑Ä‡∑î‡∂©‡∂∫:* ${message2};
‚îÇ\n`;
        for (let mem of participants) {
          mess += `‚îü @${mem.id.split("@")[0]}\n`;
        }
        mess += `‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ä∞\n\n                    *‡∂î‡∂∫‡∑è‡∂ß ‡∑É‡∑ä‡∂≠‡∑ñ‡∂≠‡∑í‡∂∫‡∑í*\n`;

        await doReact("„ÄΩÔ∏è");
        Pendragon.sendMessage(
          m.from,
          { text: mess, mentions: participants.map((a) => a.id) },
          { quoted: m }
        );

        break;

      case "chatbotgc":
        if (!isAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *‡∂î‡∂∂* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }

        if (!text) {
          await doReact("‚ùî");
          return m.reply(
            `‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∂≠‡∑ä‡∂∏‡∂ö / ‡∂Ö‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫ ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∑Ä ‡∂Ω‡∂∂‡∑è ‡∂Ø‡∑ô‡∂±‡∑ä‡∂±!\n\n*‡∂ã‡∂Ø‡∑è‡∑Ñ‡∂ª‡∂´‡∂∫‡∂ö‡∑ä:*\n\n${prefix}chatbotgc on`
          );
        }
        chatbotGCStatus = await checkGroupChatbot(m.from);
        if (args[0] == "on") {
          if (chatbotGCStatus) {
            await doReact("‚ùå");
            return m.reply(`*Group Chatbot* ‡∂Ø‡∑ê‡∂±‡∂ß‡∂∏‡∂≠‡∑ä *‡∑É‡∂∂‡∂Ω ‡∂ö‡∂ª ‡∂á‡∂≠* !`);
          }
          await doReact("üß©");
          await setGroupChatbot(m.from);
          await m.reply(
            `*Group Chatbot* *‡∑É‡∂∂‡∂Ω ‡∂ö‡∂ª ‡∂á‡∂≠* ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∑Ä ! \n\n‡∂∂‡∑ú‡∂ß‡∑ä ‡∑É‡∂≥‡∑Ñ‡∂±‡∑ä ‡∂ö‡∂ª ‡∂á‡∂≠‡∑í ‡∂¥‡∂´‡∑í‡∑Ä‡∑í‡∂©‡∑Ä‡∂Ω‡∂ß ‡∂∂‡∑ú‡∂ß‡∑ä ‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª‡∑î ‡∂±‡∑ú‡∂Ø‡∑ö!`
          );
        } else if (args[0] == "off") {
          if (!chatbotGCStatus) {
            await doReact("‚ùå");
            return m.reply(`*Group Chatbot* ‡∂Ø‡∑ê‡∂±‡∂ß‡∂∏‡∂≠‡∑ä *Disabled* !`);
          }
          await doReact("üß©");
          await delGroupChatbot(m.from);
          await m.reply(`*Group Chatbot* *‡∂Ö‡∂∂‡∂Ω ‡∂ö‡∂ª ‡∂á‡∂≠* ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∑Ä !`);
        } else {
          await doReact("‚ùî");
          return m.reply(
            `‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∂≠‡∑ä‡∂∏‡∂ö / ‡∂Ö‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫ ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∑Ä ‡∂Ω‡∂∂‡∑è ‡∂Ø‡∑ô‡∂±‡∑ä‡∂±!\n\n*‡∂ã‡∂Ø‡∑è‡∑Ñ‡∂ª‡∂´‡∂∫‡∂ö‡∑ä:*\n\n${prefix}chatbotgc on`
          );
        }

        break;

      case "antilink":
        if (!isAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *‡∂î‡∂∂* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }
        if (!isBotAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *Bot* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }

        if (!text) {
          await doReact("‚ùî");
          return m.reply(
            `‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∂≠‡∑ä‡∂∏‡∂ö / ‡∂Ö‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫ ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∑Ä ‡∂Ω‡∂∂‡∑è ‡∂Ø‡∑ô‡∂±‡∑ä‡∂±!\n\n*‡∂ã‡∂Ø‡∑è‡∑Ñ‡∂ª‡∂´‡∂∫‡∂ö‡∑ä:*\n\n${prefix}antilink on`
          );
        }
        antilinkStatus = await checkAntilink(m.from);
        if (args[0] == "on") {
          if (antilinkStatus) {
            await doReact("‚ùå");
            return m.reply(`*Antillink* ‡∂Ø‡∑ê‡∂±‡∂ß‡∂∏‡∂≠‡∑ä *‡∑É‡∂∂‡∂Ω ‡∂ö‡∂ª ‡∂á‡∂≠* !`);
          }
          await doReact("‚öúÔ∏è");
          await setAntilink(m.from);
          await m.reply(
            `*Antillink* ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∑Ä *‡∑É‡∂∂‡∂Ω ‡∂ö‡∂ª ‡∂á‡∂≠* ! \n\n‡∂∂‡∑ú‡∂ß‡∑ä ‡∂¥‡∂´‡∑í‡∑Ä‡∑í‡∂© ‡∑Ä‡∂Ω‡∑í‡∂±‡∑ä ‡∑É‡∑í‡∂∫‡∂Ω‡∑î‡∂∏ ‡∑É‡∂∂‡∑ê‡∂≥‡∑í ‡∂â‡∑Ä‡∂≠‡∑ä ‡∂ö‡∂ª‡∂∫‡∑í!`
          );
        } else if (args[0] == "off") {
          if (!antilinkStatus) {
            await doReact("‚ùå");
            return m.reply(`*Antillink* ‡∂Ø‡∑ê‡∂±‡∂ß‡∂∏‡∂≠‡∑ä *Disabled* !`);
          }
          await doReact("‚öúÔ∏è");
          await delAntilink(m.from);
          await m.reply(`*Antillink* ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∑Ä *‡∂Ö‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫ ‡∂ö‡∂ª ‡∂á‡∂≠* !`);
        } else {
          await doReact("‚ùî");
          return m.reply(
            `‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∂≠‡∑ä‡∂∏‡∂ö / ‡∂Ö‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫ ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∑Ä ‡∂Ω‡∂∂‡∑è ‡∂Ø‡∑ô‡∂±‡∑ä‡∂±!\n\n*‡∂ã‡∂Ø‡∑è‡∑Ñ‡∂ª‡∂´‡∑ä‡∂∫‡∂ö‡∑ä:*\n\n${prefix}antilink on`
          );
        }

        break;

      case "welcome":
        if (!isAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *‡∂î‡∂∂* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }
        if (!isBotAdmin) {
          await doReact("‚ùå");
          return m.reply(`‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è *Bot* *‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö* ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!`);
        }

        if (!text) {
          await doReact("‚ùî");
          return m.reply(
            `‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∂≠‡∑ä‡∂∏‡∂ö / ‡∂Ö‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫ ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∑Ä ‡∂Ω‡∂∂‡∑è ‡∂Ø‡∑ô‡∂±‡∑ä‡∂±!\n\n*‡∂ã‡∂Ø‡∑è‡∑Ñ‡∂ª‡∂´‡∂∫‡∂ö‡∑ä:*\n\n${prefix}welcome on`
          );
        }
        const welcomeStatus = await checkWelcome(m.from);
        if (args[0] == "on") {
          if (welcomeStatus) {
            await doReact("‚ùå");
            return m.reply(`*‡∑É‡∑è‡∂Ø‡∂ª‡∂∫‡∑ô‡∂±‡∑ä ‡∂¥‡∑í‡∑Ö‡∑í‡∂ú‡∂±‡∑í‡∂∏‡∑î* ‡∂Ø‡∑ê‡∂±‡∂ß‡∂∏‡∂≠‡∑ä *‡∑É‡∂∂‡∂Ω ‡∂ö‡∂ª ‡∂á‡∂≠* !`);
          }
          await doReact("üéÄ");
          await setWelcome(m.from);
          await m.reply(
            `*‡∑É‡∑è‡∂Ø‡∂ª‡∂∫‡∑ô‡∂±‡∑ä ‡∂¥‡∑í‡∑Ö‡∑í‡∂ú‡∂±‡∑í‡∂∏‡∑î/‡∂Ü‡∂∫‡∑î‡∂∂‡∑ù‡∑Ä‡∂±‡∑ä* ‡∂¥‡∂´‡∑í‡∑Ä‡∑í‡∂© *‡∑É‡∂∂‡∂Ω ‡∂ö‡∂ª ‡∂á‡∂≠* ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∑Ä !`
          );
        } else if (args[0] == "off") {
          if (!welcomeStatus) {
            await doReact("‚ùå");
            return m.reply(`*‡∑É‡∑è‡∂Ø‡∂ª‡∂∫‡∑ô‡∂±‡∑ä ‡∂¥‡∑í‡∑Ö‡∑í‡∂ú‡∂±‡∑í‡∂∏‡∑î* ‡∂Ø‡∑ê‡∂±‡∂ß‡∂∏‡∂≠‡∑ä *‡∂Ü‡∂∂‡∑è‡∂∞‡∑í‡∂≠‡∂∫‡∑í* !`);
          }
          await doReact("üéÄ");
          await delWelcome(m.from);
          await m.reply(
            `*‡∑É‡∑è‡∂Ø‡∂ª‡∂∫‡∑ô‡∂±‡∑ä ‡∂¥‡∑í‡∑Ö‡∑í‡∂ú‡∂±‡∑í‡∂∏‡∑î/‡∂Ü‡∂∫‡∑î‡∂∂‡∑ù‡∑Ä‡∂±‡∑ä* ‡∂¥‡∂´‡∑í‡∑Ä‡∑í‡∂© *‡∂Ö‡∂∂‡∂Ω ‡∂ö‡∂ª ‡∂á‡∂≠* ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∑Ä !`
          );
        } else {
          await doReact("‚ùî");
          return m.reply(
            `‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∂≠‡∑ä‡∂∏‡∂ö / ‡∂Ö‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫ ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∑Ä ‡∂Ω‡∂∂‡∑è ‡∂Ø‡∑ô‡∂±‡∑ä‡∂±!\n\n*‡∂ã‡∂Ø‡∑è‡∂ª‡∂´‡∂∫‡∂ö‡∑ä:*\n\n${prefix}welcome on`
          );
        }

        break;

      default:
        break;
    }
  },
};

async function generatePP(buffer) {
  const jimp = await Jimp.read(buffer);
  const min = jimp.getWidth();
  const max = jimp.getHeight();
  const cropped = jimp.crop(0, 0, min, max);
  return {
    img: await cropped.scaleToFit(720, 720).getBufferAsync(Jimp.MIME_JPEG),
    preview: await cropped.normalize().getBufferAsync(Jimp.MIME_JPEG),
  };
}
